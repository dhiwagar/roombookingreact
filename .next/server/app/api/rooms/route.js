"use strict";(()=>{var e={};e.id=696,e.ids=[696],e.modules={1185:e=>{e.exports=require("mongoose")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7810:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>k,patchFetch:()=>D,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{GET:()=>d,POST:()=>p});var a=r(9303),i=r(8716),o=r(670),s=r(7070),u=r(2021),c=r(3748),l=r(3431),m=r(9685);async function d(e){try{await (0,u.Z)();let{searchParams:t}=new URL(e.url),r=t.get("checkIn"),n=t.get("checkOut"),a=t.get("guests"),i=t.get("type"),o=parseInt(t.get("page")||"1"),d=parseInt(t.get("limit")||"10"),p=t.get("isAvailable"),g=t.get("search"),h={};null!=p?h.isAvailable="true"===p:r||n||(h.isAvailable=!0),a&&(h.maxGuests={$gte:parseInt(a)}),i&&(h.type=i),g&&(h.$or=[{name:{$regex:g,$options:"i"}},{description:{$regex:g,$options:"i"}},{roomId:{$regex:g,$options:"i"}}]);let f=(o-1)*d,y=await c.Z.find(h).sort({createdAt:-1}).skip(f).limit(d),k=await c.Z.countDocuments(h);if(r&&n){let e=new Date(r),t=new Date(n),a=[];for(let r of y){let n=await l.Z.find({roomId:r.roomId,status:{$ne:"cancelled"},$or:[{checkInDate:{$lt:t},checkOutDate:{$gt:e}}]});(0,m.DP)(n,e,t)&&a.push(r)}return s.NextResponse.json({success:!0,data:a,count:a.length,pagination:{page:o,limit:d,total:a.length,pages:Math.ceil(a.length/d)}})}return s.NextResponse.json({success:!0,data:y,count:y.length,pagination:{page:o,limit:d,total:k,pages:Math.ceil(k/d)}})}catch(e){return console.error("Error fetching rooms:",e),s.NextResponse.json({success:!1,error:"Failed to fetch rooms"},{status:500})}}async function p(e){try{await (0,u.Z)();let t=await e.json(),r=Date.now().toString(36),n=Math.random().toString(36).substring(2,8),a=`RM-${r}-${n}`.toUpperCase(),i=new c.Z({...t,roomId:a});return await i.save(),s.NextResponse.json({success:!0,data:i},{status:201})}catch(e){return console.error("Error creating room:",e),s.NextResponse.json({success:!1,error:"Failed to create room"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/rooms/route",pathname:"/api/rooms",filename:"route",bundlePath:"app/api/rooms/route"},resolvedPagePath:"C:\\Users\\kepre\\Downloads\\room-booking\\room-booking\\app\\api\\rooms\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:y}=g,k="/api/rooms/route";function D(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},2021:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(1185),a=r.n(n);let i=process.env.MONGODB_URI||"mongodb://localhost:27017/villa-shanti";if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose;o||(o=global.mongoose={conn:null,promise:null});let s=async function(){if(o.conn)return o.conn;o.promise||(o.promise=a().connect(i,{bufferCommands:!1}).then(e=>e));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}},9685:(e,t,r)=>{function n(){let e=Date.now().toString(36),t=Math.random().toString(36).substring(2,8);return`VS-${e}-${t}`.toUpperCase()}function a(e,t,r){let n=Math.ceil((r.getTime()-t.getTime())/864e5);return e.price*n}function i(e,t){let r=new Date;if(e<new Date(r.getFullYear(),r.getMonth(),r.getDate()))return{isValid:!1,error:"Check-in date cannot be in the past"};if(t<=e)return{isValid:!1,error:"Check-out date must be after check-in date"};let n=new Date;return(n.setFullYear(n.getFullYear()+1),e>n)?{isValid:!1,error:"Cannot book more than 1 year in advance"}:{isValid:!0}}function o(e,t,r){return!e.some(e=>{if("cancelled"===e.status)return!1;let n=new Date(e.checkInDate),a=new Date(e.checkOutDate);return t>=n&&t<a||r>n&&r<=a||t<=n&&r>=a})}function s(e,t){let r=Math.ceil((new Date(e.checkOutDate).getTime()-new Date(e.checkInDate).getTime())/864e5);return{bookingId:e.bookingId,guestName:e.name,roomName:t.name,checkIn:e.checkInDate.toLocaleDateString(),checkOut:e.checkOutDate.toLocaleDateString(),nights:r,guests:e.numberOfGuests,totalAmount:e.totalAmount,specialRequest:e.specialRequest}}r.d(t,{DP:()=>o,Jr:()=>s,p8:()=>a,pY:()=>n,yt:()=>i})},3431:(e,t,r)=>{r.d(t,{Z:()=>o});var n=r(1185),a=r.n(n);let i=new n.Schema({bookingId:{type:String,required:!0,unique:!0,trim:!0},name:{type:String,required:!0,trim:!0,maxlength:100},email:{type:String,required:!0,trim:!0,lowercase:!0,match:[/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,"Please enter a valid email"]},phone:{type:String,required:!0,trim:!0,match:[/^[\+]?[1-9][\d]{0,15}$/,"Please enter a valid phone number"]},roomId:{type:String,required:!0,ref:"Room"},checkInDate:{type:Date,required:!0,validate:{validator:function(e){return e>=new Date},message:"Check-in date must be in the future"}},checkOutDate:{type:Date,required:!0,validate:{validator:function(e){return e>this.checkInDate},message:"Check-out date must be after check-in date"}},numberOfGuests:{type:Number,required:!0,min:1,max:10},specialRequest:{type:String,trim:!0,maxlength:500},totalAmount:{type:Number,required:!0,min:0},status:{type:String,enum:["pending","confirmed","cancelled","completed"],default:"pending"},paymentStatus:{type:String,enum:["pending","paid","failed","refunded"],default:"pending"},paymentMethod:{type:String,trim:!0}},{timestamps:!0});i.index({email:1}),i.index({checkInDate:1,checkOutDate:1}),i.index({status:1}),i.index({createdAt:-1}),i.index({roomId:1,checkInDate:1,checkOutDate:1,status:1});let o=a().models.Booking||a().model("Booking",i)},3748:(e,t,r)=>{r.d(t,{Z:()=>o});var n=r(1185),a=r.n(n);let i=new n.Schema({roomId:{type:String,required:!0,unique:!0,trim:!0},name:{type:String,required:!0,trim:!0},type:{type:String,required:!0,enum:["deluxe","suite","premium","standard"]},price:{type:Number,required:!0,min:0},maxGuests:{type:Number,required:!0,min:1,max:10},size:{type:String,required:!0},amenities:[{type:String,trim:!0}],images:[{type:String,trim:!0}],description:{type:String,required:!0,trim:!0},features:[{type:String,trim:!0}],isAvailable:{type:Boolean,default:!0},rating:{type:Number,min:0,max:5,default:4.5}},{timestamps:!0});i.index({type:1}),i.index({price:1}),i.index({isAvailable:1});let o=a().models.Room||a().model("Room",i)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,972],()=>r(7810));module.exports=n})();