"use strict";(()=>{var e={};e.id=946,e.ids=[946],e.modules={1185:e=>{e.exports=require("mongoose")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1212:e=>{e.exports=require("async_hooks")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},3757:e=>{e.exports=import("prettier/plugins/html")},5747:e=>{e.exports=import("prettier/standalone")},4492:e=>{e.exports=require("node:stream")},5491:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>D,requestAsyncStorage:()=>k,routeModule:()=>h,serverHooks:()=>x,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{GET:()=>p,POST:()=>g});var a=r(9303),i=r(8716),s=r(670),o=r(7070),u=r(2021),c=r(3431),m=r(3748),l=r(9685),d=r(7149);async function p(e){try{await (0,u.Z)();let{searchParams:t}=new URL(e.url),r=t.get("email"),n=t.get("status"),a=parseInt(t.get("page")||"1"),i=parseInt(t.get("limit")||"10"),s={};r&&(s.email=r),n&&(s.status=n);let m=(a-1)*i,l=await c.Z.find(s).sort({createdAt:-1}).skip(m).limit(i),d=await c.Z.countDocuments(s);return o.NextResponse.json({success:!0,data:l,pagination:{page:a,limit:i,total:d,pages:Math.ceil(d/i)}})}catch(e){return console.error("Error fetching bookings:",e),o.NextResponse.json({success:!1,error:"Failed to fetch bookings"},{status:500})}}async function g(e){try{await (0,u.Z)();let{name:t,email:r,phone:n,roomId:a,checkInDate:i,checkOutDate:s,numberOfGuests:p,specialRequest:g}=await e.json();if(!t||!r||!n||!a||!i||!s||!p)return o.NextResponse.json({success:!1,error:"Missing required fields"},{status:400});let h=new Date(i),k=new Date(s),f=(0,l.yt)(h,k);if(!f.isValid)return o.NextResponse.json({success:!1,error:f.error},{status:400});let x=await m.Z.findOne({roomId:a,isAvailable:!0});if(!x)return o.NextResponse.json({success:!1,error:"Room not found or not available"},{status:404});if(p>x.maxGuests)return o.NextResponse.json({success:!1,error:`Room can accommodate maximum ${x.maxGuests} guests`},{status:400});let y=await c.Z.find({roomId:a,status:{$ne:"cancelled"},$or:[{checkInDate:{$lt:k},checkOutDate:{$gt:h}}]});if(!(0,l.DP)(y,h,k))return o.NextResponse.json({success:!1,error:"Room is not available for the selected dates"},{status:409});let D=(0,l.p8)(x,h,k),b=new c.Z({bookingId:(0,l.pY)(),name:t,email:r,phone:n,roomId:a,checkInDate:h,checkOutDate:k,numberOfGuests:p,specialRequest:g,totalAmount:D});await b.save();try{let e=await (0,d.h)({booking:b,room:x});console.log("Email result:",e)}catch(e){console.error("Email sending failed:",e)}let w=(0,l.Jr)(b,x);return o.NextResponse.json({success:!0,data:b,confirmation:w,message:"Booking created successfully! Confirmation email sent."},{status:201})}catch(e){return console.error("Error creating booking:",e),o.NextResponse.json({success:!1,error:"Failed to create booking"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/bookings/route",pathname:"/api/bookings",filename:"route",bundlePath:"app/api/bookings/route"},resolvedPagePath:"C:\\Users\\kepre\\Downloads\\room-booking\\room-booking\\app\\api\\bookings\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:k,staticGenerationAsyncStorage:f,serverHooks:x}=h,y="/api/bookings/route";function D(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:f})}},9685:(e,t,r)=>{function n(){let e=Date.now().toString(36),t=Math.random().toString(36).substring(2,8);return`VS-${e}-${t}`.toUpperCase()}function a(e,t,r){let n=Math.ceil((r.getTime()-t.getTime())/864e5);return e.price*n}function i(e,t){let r=new Date;if(e<new Date(r.getFullYear(),r.getMonth(),r.getDate()))return{isValid:!1,error:"Check-in date cannot be in the past"};if(t<=e)return{isValid:!1,error:"Check-out date must be after check-in date"};let n=new Date;return(n.setFullYear(n.getFullYear()+1),e>n)?{isValid:!1,error:"Cannot book more than 1 year in advance"}:{isValid:!0}}function s(e,t,r){return!e.some(e=>{if("cancelled"===e.status)return!1;let n=new Date(e.checkInDate),a=new Date(e.checkOutDate);return t>=n&&t<a||r>n&&r<=a||t<=n&&r>=a})}function o(e,t){let r=Math.ceil((new Date(e.checkOutDate).getTime()-new Date(e.checkInDate).getTime())/864e5);return{bookingId:e.bookingId,guestName:e.name,roomName:t.name,checkIn:e.checkInDate.toLocaleDateString(),checkOut:e.checkOutDate.toLocaleDateString(),nights:r,guests:e.numberOfGuests,totalAmount:e.totalAmount,specialRequest:e.specialRequest}}r.d(t,{DP:()=>s,Jr:()=>o,p8:()=>a,pY:()=>n,yt:()=>i})},3431:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(1185),a=r.n(n);let i=new n.Schema({bookingId:{type:String,required:!0,unique:!0,trim:!0},name:{type:String,required:!0,trim:!0,maxlength:100},email:{type:String,required:!0,trim:!0,lowercase:!0,match:[/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,"Please enter a valid email"]},phone:{type:String,required:!0,trim:!0,match:[/^[\+]?[1-9][\d]{0,15}$/,"Please enter a valid phone number"]},roomId:{type:String,required:!0,ref:"Room"},checkInDate:{type:Date,required:!0,validate:{validator:function(e){return e>=new Date},message:"Check-in date must be in the future"}},checkOutDate:{type:Date,required:!0,validate:{validator:function(e){return e>this.checkInDate},message:"Check-out date must be after check-in date"}},numberOfGuests:{type:Number,required:!0,min:1,max:10},specialRequest:{type:String,trim:!0,maxlength:500},totalAmount:{type:Number,required:!0,min:0},status:{type:String,enum:["pending","confirmed","cancelled","completed"],default:"pending"},paymentStatus:{type:String,enum:["pending","paid","failed","refunded"],default:"pending"},paymentMethod:{type:String,trim:!0}},{timestamps:!0});i.index({email:1}),i.index({checkInDate:1,checkOutDate:1}),i.index({status:1}),i.index({createdAt:-1}),i.index({roomId:1,checkInDate:1,checkOutDate:1,status:1});let s=a().models.Booking||a().model("Booking",i)},3748:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(1185),a=r.n(n);let i=new n.Schema({roomId:{type:String,required:!0,unique:!0,trim:!0},name:{type:String,required:!0,trim:!0},type:{type:String,required:!0,enum:["deluxe","suite","premium","standard"]},price:{type:Number,required:!0,min:0},maxGuests:{type:Number,required:!0,min:1,max:10},size:{type:String,required:!0},amenities:[{type:String,trim:!0}],images:[{type:String,trim:!0}],description:{type:String,required:!0,trim:!0},features:[{type:String,trim:!0}],isAvailable:{type:Boolean,default:!0},rating:{type:Number,min:0,max:5,default:4.5}},{timestamps:!0});i.index({type:1}),i.index({price:1}),i.index({isAvailable:1});let s=a().models.Room||a().model("Room",i)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,972,511],()=>r(5491));module.exports=n})();